{% extends 'base.html' %}
{% block title %}Health Metrics | Healthcare Guardian{% endblock %}

{% block styles %}
  <style>
    /* Add custom styles here */
    .health-metrics-container {
      max-width: 800px;
      margin: auto;
      padding: 20px;
      margin-top: 100px;
    }
    .health-metrics-header {
      text-align: center;
      margin-bottom: 20px;
    }
    .chart-container {
      margin-bottom: 20px;
    }
  </style>
{% endblock %}
{% block content %}
  <div class="container">
    <div class="row">
      <div class="col-md-12">
        <div class="health-metrics-container">
          <h2 class="health-metrics-header">Health Metrics</h2>

          <div class="card metric-card">
            <div class="card-body">
              <h5 class="card-title">Current Body Status</h5>
              <p class="card-text">
                Your current body status is <strong>Good</strong>. Keep up with your healthy lifestyle!
              </p>
            </div>
          </div>

          <!-- Heart rate data display -->
          <div class="card">
            <div class="card-body">
              <h5 class="card-title">Heart Rate Readings</h5>
              <p class="card-text">
                <!-- Display multiple heart rate readings within a day -->
                <ul id="heartRateReadingsToday">
                  <!-- Heart rate readings will be dynamically updated here -->
                </ul>
              </p>
            </div>
          </div>
          <!-- Month and Year selector -->
          <div class="form-row">
            <div class="form-group col-md-3">
              <label for="monthSelector">Select Month:</label>
              <select id="monthSelector" class="form-control">
                <option value="1">January</option>
                <option value="2">February</option>
                <!-- Add options for all months -->
              </select>
            </div>
            <div class="form-group col-md-3">
              <label for="yearSelector">Select Year:</label>
              <select id="yearSelector" class="form-control">
                <option value="2022">2022</option>
                <option value="2023">2023</option>
                <!-- Add options for years as needed -->
              </select>
            </div>
          </div>
          <!-- Heart rate graph plot -->
          <div class="chart-container">
            <canvas id="heartRateChart"></canvas>
          </div>
          <!-- Heart rate data display for previous dates -->
          <div class="row">
            <div class="col-md-6">
              <h5 class="card-title">Heart Rate Readings for Previous Dates</h5>
              <div class="form-group">
                <label for="dateSelector">Select Date:</label>
                <input type="date" id="dateSelector" class="form-control">
              </div>
            </div>
            <div class="col-md-6">
              <ul id="heartRateReadings" class="list-group">
                <!-- Sample heart rate readings -->
                <li class="list-group-item">8:00 AM - 75 bpm</li>
                <li class="list-group-item">10:00 AM - 80 bpm</li>
                <li class="list-group-item">12:00 PM - 85 bpm</li>
                <li class="list-group-item">2:00 PM - 82 bpm</li>
              </ul>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>


{% endblock %}

{% block scripts %}
<script>
$(document).ready(function() {
  // Function to fetch and update heart rate readings
  function updateHeartRateReadings() {
    var heartRateTodayList = $('#heartRateReadingsToday');

    // Fetch heart rate data from the server
    fetch("{{ url_for('fetch_heart_rate_today') }}").then((data) => data.json()).then((data) => {
    //$.ajax({
    //  url: "{{ url_for('fetch_heart_rate_today') }}",
    //  type: "GET",
    //  dataType: "json",
    //  success: function(data) {
        // Clear previous readings
        heartRateTodayList.empty();

        // Iterate over the fetched heart rate data and add it to the UI
        data.response.forEach(function(reading) {
          var readingItem = $('<li>').text(reading.starttime + ' - ' + reading.heart_rate + ' bpm');
          heartRateTodayList.append(readingItem);
        });
    })
      //error: 
      .catch((error)=>    //(xhr, status, error) {
        console.error('Error fetching heart rate data:', error));
      
  };

  // Call the function to update heart rate readings initially
  updateHeartRateReadings();

  // Update heart rate readings every 30 seconds
  setInterval(updateHeartRateReadings, 3000);
});
</script>
{% endblock %}