{% extends 'base.html' %}
{% block title %}Health Metrics | Healthcare Guardian{% endblock %}

{% block styles %}
  <style>
    /* Add custom styles here */
    .health-metrics-container {
      max-width: 800px;
      margin: auto;
      padding: 20px;
      margin-top: 100px;
    }
    .health-metrics-header {
      text-align: center;
      margin-bottom: 20px;
    }
    .chart-container {
      margin-bottom: 20px;
    }
  </style>
{% endblock %}
{% block content %}
  <div class="container">
    <div class="row">
      <div class="col-md-12">
        <div class="health-metrics-container">
          <h2 class="health-metrics-header">Health Metrics</h2>

          <div class="card metric-card">
            <div class="card-body">
              <h5 class="card-title">Current Body Status</h5>
              <p class="card-text">
                Your current body status is <strong>Good</strong>. Keep up with your healthy lifestyle!
              </p>
            </div>
          </div>

          <!-- Heart rate data display -->
          <div class="card">
            <div class="card-body">
              <h5 class="card-title">Heart Rate Readings</h5>
              <p class="card-text">
                <!-- Display multiple heart rate readings within a day -->
                <ul id="heartRateReadingsToday">
                  <!-- Heart rate readings will be dynamically updated here -->
                </ul>
              </p>
            </div>
          </div>
          <!-- Month and Year selector -->
          <div class="form-row">
            <div class="form-group col-md-3">
              <label for="monthSelector">Select Month:</label>
              <select id="monthSelector" class="form-control">
                <option value="1">January</option>
                <option value="2">February</option>
                <!-- Add options for all months -->
              </select>
            </div>
            <div class="form-group col-md-3">
              <label for="yearSelector">Select Year:</label>
              <select id="yearSelector" class="form-control">
                <option value="2022">2022</option>
                <option value="2023">2023</option>
                <!-- Add options for years as needed -->
              </select>
            </div>
          </div>
          <!-- Heart rate graph plot -->
          <div class="chart-container">
            <canvas id="heartRateChart"></canvas>
          </div>
          <!-- Heart rate data display for previous dates -->
          <div class="row">
            <div class="col-md-6">
              <h5 class="card-title">Heart Rate Readings for Previous Dates</h5>
              <div class="form-group">
                <label for="dateSelector">Select Date:</label>
                <input type="date" id="dateSelector" class="form-control">
              </div>
            </div>
            <div class="col-md-6">
              <ul id="heartRateReadings" class="list-group">
                <!-- Sample heart rate readings -->
                <li class="list-group-item">8:00 AM - 75 bpm</li>
                <li class="list-group-item">10:00 AM - 80 bpm</li>
                <li class="list-group-item">12:00 PM - 85 bpm</li>
                <li class="list-group-item">2:00 PM - 82 bpm</li>
              </ul>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>


{% endblock %}
{% block scripts %}
  <script>

  $(document).ready(function() {
    // Heart rate chart
    // var heartRateCtx = document.getElementById('heartRateChart').getContext('2d');
    // var heartRateChart = new Chart(heartRateCtx, {
    //   type: 'line',
    //   data: {
    //     labels: ['1', '2', '3', '4', '5', '6', '7', '8', '9', '10', '11', '12', '13', '14', '15', '16', '17', '18', '19', '20', '21', '22', '23', '24', '25', '26', '27', '28', '29', '30', '31'],
    //     datasets: [{
    //       label: 'Average Heart Rate (bpm)',
    //       data: [75, 80, 85, 78, 90, 82, 79, 72, 87, 88, 83, 81, 75, 79, 80, 77, 85, 90, 78, 81, 84, 86, 89, 83, 82, 80, 79, 81, 84, 88, 86],
    //       borderColor: 'blue',
    //       backgroundColor: 'rgba(0, 0, 255, 0.1)',
    //       borderWidth: 1
    //     }]
    //   },
    //   options: {
    //     scales: {
    //       y: {
    //         beginAtZero: true
    //       }
    //     }
    //   }
    // });

    // Update heart rate readings
    // function updateHeartRateReadings() {
    //   var heartRateTodayList = document.getElementById('heartRateReadingsToday');
    //   heartRateTodayList.innerHTML = ''; // Clear previous readings

      // Sample heart rate readings (replace with fetched data in real implementation)
      // var sampleReadings = [
      //   { time: '8:00 AM', bpm: 75 },
      //   { time: '10:00 AM', bpm: 80 },
      //   { time: '12:00 PM', bpm: 85 },
      //   { time: '2:00 PM', bpm: 82 }
      //   // Add more sample readings as needed
      // ];

      // sampleReadings.forEach(function(reading) {
      //   var readingItem = document.createElement('li');
      //   readingItem.textContent = reading.time + ' - ' + reading.bpm + ' bpm';
      //   heartRateTodayList.appendChild(readingItem);
      // });
      
      //setInterval(updateHeartRateReadings, 30000);
      updateHeartRateReadings();

      setInterval(updateHeartRateReadings, 2000);
      function updateHeartRateReadings() {
      var heartRateTodayList = $('#heartRateReadingsToday');

      // Clear previous readings
      heartRateTodayList.empty();

      // Fetch heart rate data from the server
      $.ajax({
        url: "{{ url_for('fetch_heart_rate_today') }}",
        type: "GET",
        dataType: "json",
        success: function(data) {
          // Iterate over the fetched heart rate data and add it to the UI
          data.response.forEach(function(reading) {
            var readingItem = $('<li>').text(reading.starttime + ' - ' + reading.heart_rate + ' bpm');
            heartRateTodayList.append(readingItem);
          });
        },
        error: function(xhr, status, error) {
          console.error('Error fetching heart rate data:', error);
        }
      });
    }

    // Function to periodically update heart rate readings
    // function updateHeartRatePeriodically() {
    //   updateHeartRateReadings(); // Initial update
    //   // Update heart rate readings every 5 seconds
    //   setInterval(updateHeartRateReadings, 2000);
    // }

    // // Call the function to update heart rate readings periodically
    // updateHeartRatePeriodically();

    // Call the function to update heart rate readings
    // updateHeartRateReadings();
  });
  </script>
{% endblock %}